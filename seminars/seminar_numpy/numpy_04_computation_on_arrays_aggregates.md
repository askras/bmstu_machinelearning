---
jupyter:
  jupytext:
    text_representation:
      extension: .md
      format_name: markdown
      format_version: '1.3'
      jupytext_version: 1.16.4
  kernelspec:
    display_name: Python 3 (ipykernel)
    language: python
    name: python3
---

# Агрегирование: минимум, максимум и все, что между ними


Часто при работе с большим объемом данных первым шагом становится вычисление сводной статистики для рассматриваемых данных.
Пожалуй, наиболее распространенными сводными статистическими показателями являются среднее значение и стандартное отклонение, которые позволяют вывить &laquo;типичные&raquo; значения в наборе данных, но полезны и другие агрегаты (сумма, произведение, медиана, минимум и максимум, квантили и т. д.).

Далее рассмотрим реализованные в NumPy быстрые функции агрегирования для массивов.


## Суммирование значений в массиве

В качестве первого примера рассмотрим вычисление суммы всех значений в массиве.

```python jupyter={"outputs_hidden": false}
import numpy as np
```

```python jupyter={"outputs_hidden": false}
L = np.random.random(100)
np.sum(L)
```

Синтаксис очень похож на функцию `sum` стандартной библиотеки Python.
И результат в простейшем случае тот же:

```python jupyter={"outputs_hidden": false}
sum(L)
```

Однако, поскольку функция `np.sum` выполняется в скомпилированном 
коде, она вычисляется гораздо быстрее встроенной функции `sum`:

```python jupyter={"outputs_hidden": false}
big_array = np.random.rand(1000000)
%timeit sum(big_array)
%timeit np.sum(big_array)
```

Однако следует соблюдать осторожность: функции `sum` и `np.sum` не идентичны, и это иногда может привести к путанице!
В частности, их необязательные аргументы имеют разные значения, а еще `np.sum` умеет работать с многомерными массивами.


## Минимум и максимум

В стандартной библиотеке Python доступны функции `min` `max`, которые используются для поиска минимального и максимального значения любого массива:

```python jupyter={"outputs_hidden": false}
min(big_array), max(big_array)
```

Соответствующие им функции NumPy имеют похожий синтаксис и ожидаемо работают гораздо быстрее:

```python jupyter={"outputs_hidden": false}
np.min(big_array), np.max(big_array)
```

```python jupyter={"outputs_hidden": false}
%timeit min(big_array)
%timeit np.min(big_array)
```

`min`, `max`, `sum` и несколько других агрегатов NumPy иногда удобнее вызывать как методы самого объекта массива:

```python jupyter={"outputs_hidden": false}
print(big_array.min(), big_array.max(), big_array.sum())
```

### Многомерные агрегаты

Одним из распространенных типов операций агрегирования является агрегирование по строкам или столбцам.
Допустим, имеются данные, хранящиеся в двумерном массиве:

```python jupyter={"outputs_hidden": false}
M = np.random.random((3, 4))
print(M)
```

По умолчанию каждая функция агрегирования NumPy возвращает сводный показатель по всему массиву:

```python jupyter={"outputs_hidden": false}
M.sum()
```

При необходимости агрегирования только по строкам или только по столбцам, можно использовать необязательный аргумент `axis`, указывающий *ось*, вдоль которой вычисляется агрегат. 
Например, мы можем найти минимальное значение в каждом столбце, указав `axis=0`:

```python jupyter={"outputs_hidden": false}
M.min(axis=0)
```

Функция возвращает четыре значения, соответствующие четырем столбцам чисел.

Аналогично находится максимальное значение в каждой строке:

```python jupyter={"outputs_hidden": false}
M.max(axis=1)
```

Для лучшего поминания следует помнить, что ключевое слово `axis` указывает *ось массива, которая будет свернута*.
Таким образом, указание `axis=0` означает, что ось с индексом 0 (строки) будет свернута: для двумерных массивов это означает, что значения в каждом столбце будут агрегированы.
Аналогично, указание `axis=1` означает, что ось с индексом 1 (столбцы) будет свернута: для двумерных массивов это означает, что значения в каждой строке будут агрегированы.


![Индуксация массивов](./img/axis.png)


### Другие функции агрегирования

NumPy предоставляет множество других функций агрегирования, которые не будут здесь подробно обсуждаться.
Заметим лишь, что большинство функций агрегаторов имеют `NaN`-безопасный аналог, который вычисляет результат, игнорируя пропущенные значения, которые помечаются специальным определенным организацией IEEE значением с плавающей точкой `NaN` .

В следующей таблице представлен список полезных функций агрегирования, доступных в NumPy:

|Имя функции      | NaN-безопасная версия | Описание |
|---|---|---|
| `np.sum`        | `np.nansum`       | Возвращает сумму элементов |
| `np.prod`       | `np.nanprod`      | Возвращает произведение элементов |
| `np.mean`       | `np.nanmean`      | Возвращает среднее значение элементов |
| `np.std`        | `np.nanstd`       | Возвращает стандартное отклонение |
| `np.var`        | `np.nanvar`       | Возвращает дисперсию |
| `np.min`        | `np.nanmin`       | Возвращает минимальное значение |
| `np.max`        | `np.nanmax`       | Находит максимальное значение |
| `np.argmin`     | `np.nanargmin`    | Возвращает индекс минимального значения |
| `np.argmax`     | `np.nanargmax`    | Возвращает индекс максимального значения |
| `np.median`     | `np.nanmedian`    | Возвращает медиану элементов |
| `np.percentile` | `np.nanpercentile`| Возвращает квантили элементов |
| `np.any`        | N/A               | Оценивает, являются ли какие-либо элементы истинными |
| `np.all`        | N/A               | Оценивает, все ли элементы истинны |


Представленные агрегаторы являются одними из основных элементов разведочного анализа данных.
